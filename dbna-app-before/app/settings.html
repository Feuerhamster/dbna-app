<style>
body{
    background: linear-gradient(45deg, #0cbcf1 0, #8a0ebd 100%);
}
.titlebar{
    background: rgba(0,0,0,0)!important;
}
</style>


<center style="padding: 30px 150px 0px 150px;overflow-y:auto;max-height: calc(100% - 30px);">

    <h1 style="margin-bottom: 25px">Desktop-App Einstellungen</h1>
    
    <div class="panel">
        <h2 style="margin-bottom: 20px">Passwortsperre festlegen</h2>
        <h4>Hier kannst du die App mit einem von dir gewählten Passwort sichern. <br/>Es wird bei jedem Start der App abgefragt. So kann niemand eindringen!<br/><br/></h4>
        
        <input type="password" id="input-password" placeholder="Neues Passwort eingeben"></input>
        <button class="button" onclick="resetPassword();" id="reset-pw-button">Aktuelles Passwort löschen</button>

    </div>

    <br/><br/>

    <div class="panel">
        <h2 style="margin-bottom: 20px">Popups</h2>
        
        <h4>Möchtest du, das neue Fenster und/oder Popups in einem eigenen Fenster von DBNA geöffnet werden, oder dein Standartbrowser benutzt wird?</h4>
        <br/><br/>
        <select id="input-popup" style="width: 300px">
            <option value="customWindow">Eigenes Fenster</option>
            <option value="browser">Browser</option>
        </select>

    </div>

    <br/><br/>

    <div class="panel">

        <h2 style="margin-bottom: 20px">Startseite</h2>
        
        <h4>Setze die Startseite, die du sehen möchtest, wenn du das Programm öffnest. Als Standart ist der Stream von DBNA eingestellt. Wenn du den Standart wiederherstellen möchtest, lasse das Feld leer.</h4>
        <br/><br/>
        <input id="input-home" type="text" placeholder="Link zur gewünschten Startseite">
    
    </div>
    
    <br/><br/>

    <div class="panel">
        <h2 style="margin-bottom: 20px">Dunkles Design</h2>
        
        <h4>DBNA wird dir normalerweise mit hellen Farben angezeigt. Wenn du aber lieber dunklere Farben bevorzugst, kannst du das hier einstellen. Dies ist momentan noch eine experimentelle Funktion. Es kann zu design- und Farbfehlern kommen.</h4>
        <br/><br/>
        <h4 style="display: inline-block"><label class="switch" style="float: left;">
            <input type="checkbox" id="input-dark">
            <span class="slider round"></span>
        </label><span style="float: left;margin-left: 10px;font-size: 18px;">Dunkles Design aktivieren</span></h4><br/><br/>

    </div>

    <br/><br/>

    <div class="panel">
        <h2 style="margin-bottom: 20px">Discord Rich Presence</h2>
        
        <h4>Wenn du möchtest, das DBNA in Discord als deine Aktivität angezeigt wird, aktiviere diese Funktion.</h4>
        <br/><br/>
        <h4 style="display: inline-block"><label class="switch" style="float: left;">
            <input type="checkbox" id="input-rpc">
            <span class="slider round"></span>
        </label><span style="float: left;margin-left: 10px;font-size: 18px;">Rich Presence aktivieren</span></h4><br/><br/>

    </div>

    <br/><br/>

    <div class="panel">
        <h2 style="margin-bottom: 20px">Benachrichtigungen</h2>
        
        <h4>Wenn du eine Benachrichtigung oder eine Chatnachticht auf DBNA bekommst, wirst du automatisch eine Systembenachrichtigung bekommen.<br/>Verwalte hier die Einstellungen der Benachrichtigungen.</h4>
        <br/><br/>

        <h4 style="display: inline-block"><label class="switch" style="float: left;">
            <input type="checkbox" id="input-general-notifications">
            <span class="slider round"></span>
        </label><span style="float: left;margin-left: 10px;font-size: 18px;">Ich möchte generell Desktop-Benachrichtigungen erhalten.</span></h4><br/><br/>
    

        <h4 style="display: inline-block"><label class="switch" style="float: left;">
            <input type="checkbox" id="input-push-notifications">
            <span class="slider round"></span>
        </label><span style="float: left;margin-left: 10px;font-size: 18px;">"Push-Benachrichtigungen" von DBNA erhalten.</span></h4><br/><br/>

        <h4 style="display: inline-block"><label class="switch" style="float: left;">
            <input type="checkbox" id="input-chat-notifications">
            <span class="slider round"></span>
        </label><span style="float: left;margin-left: 10px;font-size: 18px;">"Chat-Benachrichtigungen" von DBNA erhalten.</span></h4><br/><br/>
    

    </div>

    <br/><br/>

    <div class="panel">
        <h2 style="margin-bottom: 20px">Browserdaten Löschen</h2>
        
        <h4>Leere den Cache und lösche alle Cookies. Eventuell musst du dich danach neu anmelden.</h4>
        <br/><br/>

        <button class="button" onclick="clearBrowserData();" id="delete-browserdata-button">Browserdaten löschen</button>

    </div>

    <br/><br/>

    <div class="panel">
        <h2 style="margin-bottom: 20px">Über die App</h2>
        
        <h4>Dieses Projekt ist inoffiziell. Der Entwickler ist kein Teil oder Mitarbeiter der DBNA GmbH. <br/>Es wurden zur Entwicklung nur frei verfügbare Daten und APIs genutzt.</h4>
        <br/><br/>
        <button onclick="opn('https:\/\/dbnaApp.hamsterlabs.de')" class="button">Webseite öffnen</button> <button onclick="opn('https:\/\/hamsterlabs.de')" class="button">Webseite des Entwicklers öffnen</button>

    </div>

    <br/><br/>

    <button class="button" onclick="loadSettingsPage();" style="margin-top: 35px;margin-bottom: 35px;">Zurück zu DBNA</button>
    <button class="button" onclick="win.reload();" style="margin-top: 35px;margin-bottom: 35px;">App neu laden</button>

</center>

<script>
var cfgdata = jf.readFileSync(__dirname+"\\..\\config.json");
$("#input-popup").val(cfgdata.popup)
$("#input-general-notifications").attr("checked", cfgdata.msg.general);
$("#input-push-notifications").attr("checked", cfgdata.msg.push);
$("#input-chat-notifications").attr("checked", cfgdata.msg.chat);
$("#input-dark").attr("checked", cfgdata.darkMode);
$("#input-rpc").attr("checked", cfgdata.rpc);

$("#input-home").val(cfgdata.homepage);

if(cfgdata.password == false){
    $("#reset-pw-button").css("display", "none");
}

$("#input-password").change(function(event){
    
    var sha256 = require('js-sha256');
    var hash = sha256.create();
    hash.update(event.target.value);
    
    cfgdata.password = hash.hex();
    console.log(cfgdata.password);
    saveSettings(cfgdata);

    $("#lockbutton").css("display", "block");
    $("#reset-pw-button").css("display", "block");

});

$("#input-popup").change(function(event){
    cfgdata.popup = event.target.value;
    saveSettings(cfgdata);
});

$("#input-home").change(function(event){
    
    var regex = /https\:\/\/(www\.)?dbna\.com.+/gi;

    if(event.target.value.match(regex)){
        cfgdata.homepage = event.target.value;
        saveSettings(cfgdata);
    }else{
        alert('Die Startseite muss eine Seite auf DBNA sein!\nZum Beispiel "https://dbna.com/forum" oder "https://www.dbna.com/"');
    }
    

});


$("#input-general-notifications").change(function(event){
    cfgdata.msg.general = event.target.checked;
    saveSettings(cfgdata);
});
$("#input-push-notifications").change(function(event){
    cfgdata.msg.push = event.target.checked;
    saveSettings(cfgdata);
});
$("#input-chat-notifications").change(function(event){
    cfgdata.msg.chat = event.target.checked;
    saveSettings(cfgdata);
});

$("#input-dark").change(function(event){
    cfgdata.darkMode = event.target.checked;
    saveSettings(cfgdata);
});

$("#input-rpc").change(function(event){
    cfgdata.rpc = event.target.checked;
    saveSettings(cfgdata);
});


function saveSettings(newcfg){
    jf.writeFileSync(__dirname+"\\..\\config.json", newcfg, { spaces: 4 });
}

function resetPassword(){
    cfgdata.password = false;
    saveSettings(cfgdata);
    $("#lockbutton").css("display", "none");
    $("#reset-pw-button").html("Passwort gelöscht!");
    setTimeout(()=>{
        $("#reset-pw-button").css("display", "none");
    },2000);
}

function clearBrowserData(){
    win.webContents.session.clearCache(function(){
        console.log("[renderer] Session cache cleared");
    });
    win.webContents.session.clearStorageData(function(){
        console.log("[renderer] Storage data cleared");
    });
    $("#delete-browserdata-button").html("Browserdaten gelöscht!");
    setTimeout(()=>{
        $("#delete-browserdata-button").html("Browserdaten löschen");
    },2000);
}
</script>